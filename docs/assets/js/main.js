"use strict";let searchResults,favoriteSeries=loadFavorites();renderFavoritesList();const button=selectElementByClass(".js-button"),resetButton=selectElementByClass(".js-favorites__list--item__btn--reset"),input=selectElementByClass(".js-search-field"),resultsTitle=selectElementByClass(".js-results__title");function getSeriesData(){const e=input.value;fetch("//api.tvmaze.com/search/shows?q="+e).then(e=>e.json()).then(e=>{if(0===e.length)resultsTitle.innerHTML="No se ha encontrado ninguna serie con este nombre";else{resultsTitle.innerHTML="Resultados",searchResults=[];for(let t=0;t<e.length;t++){let s={};s.name=e[t].show.name,s.id=e[t].show.id,null===e[t].show.image?s.imageSource="https://via.placeholder.com/210x295/ffffff/666666/?%20text=TV":null===e[t].show.image.medium?s.imageSource=e[t].show.image.original:s.imageSource=e[t].show.image.medium,searchResults.push(s)}}renderSearchResults(),addListenersToResultItems()})}function renderSearchResults(){let e=selectElementByClass(".js-results__list");e.innerHTML="";for(let t of searchResults){const s=document.createElement("li"),i=document.createElement("img"),r=document.createElement("h3");s.setAttribute("class","results__list--item js-results__list--item"),s.setAttribute("id",t.id),s.dataset.sourceObject=JSON.stringify(t),e.appendChild(s),i.setAttribute("class","results__list--item__img js-results__list--item__img"),i.src=t.imageSource,r.setAttribute("class","results__list--item__title js-results__list--item__title"),r.innerHTML=t.name,s.append(i,r);for(let e of favoriteSeries)if(t.id===e.id){s.classList.add("favorite");break}e.appendChild(s)}}function addListenersToResultItems(){const e=document.querySelectorAll(".js-results__list--item");for(const t of e)t.addEventListener("click",onFavoriteItemClick)}function renderFavoritesList(){const e=selectElementByClass(".js-favorites__list"),t=selectElementByClass(".js-favorites");if(e.innerHTML="",0===favoriteSeries.length)t.classList.add("hidden");else for(let s of favoriteSeries)t.classList.remove("hidden"),createFavoriteElement(e,favoriteSeries,s)}function onFavoriteItemClick(e){const t=selectElementByClass(".js-favorites"),s=selectElementByClass(".js-favorites__list");t.classList.remove("hidden");const i=e.currentTarget,r=parseInt(i.id),l=favoriteSeries.findIndex(e=>e.id===r);if(i.classList.toggle("favorite"),-1===l){const e=JSON.parse(i.dataset.sourceObject);favoriteSeries.push(e),createFavoriteElement(s,favoriteSeries,e),saveFavorites(favoriteSeries)}else{let e;for(let t of favoriteSeries)if(t.id===r){e=t;break}removeFavorite(favoriteSeries,e)}}function createFavoriteElement(e,t,s){const i=document.createElement("li"),r=document.createElement("button");r.type="button",r.setAttribute("class","favorites__list--item__btn js-favorites__list--item__btn");const l=document.createElement("img");l.src="./assets/images/close-button.png",l.setAttribute("class","favorites__list--item__btn-img js-favorites__list--item__btn-img"),r.appendChild(l),i.appendChild(r),i.setAttribute("class","favorites__list--item js-favorites__list--item");const o=document.createElement("img");o.setAttribute("class","favorites__list--item__img js-favorites__list--item__img"),o.src=s.imageSource;const a=document.createElement("h4");a.setAttribute("class","favorites__list--item__title js-favorites__list--item__title"),a.innerHTML=s.name,i.append(o,a),e.appendChild(i),r.addEventListener("click",e=>{removeFavorite(t,s)})}function loadFavorites(){const e=JSON.parse(localStorage.getItem("Favorite series"));let t;return t=null===e?[]:e,t}function saveFavorites(e){localStorage.setItem("Favorite series",JSON.stringify(e))}function removeFavorite(e,t){const s=e.indexOf(t);e.splice(s,1),saveFavorites(e),renderFavoritesList();const i=document.querySelectorAll(".results__list--item");for(let e of i)if(parseInt(e.id)===t.id){e.classList.remove("favorite");break}}function resetFavorites(){localStorage.removeItem("Favorite series"),favoriteSeries=loadFavorites(),renderFavoritesList();const e=document.querySelectorAll(".results__list--item");for(let t of e)t.classList.remove("favorite")}function selectElementByClass(e){return document.querySelector(e)}resetButton.addEventListener("click",resetFavorites),button.addEventListener("click",getSeriesData),input.addEventListener("keydown",(function(e){"Enter"===e.code&&(e.preventDefault(),e.stopPropagation(),button.click())}));